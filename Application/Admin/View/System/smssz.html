 <include file="Public/header"/>
  <include file="Public/top"/>
  <include file="Public/left-nav"/>
<!-- Content Wrapper. Contains page content -->
<!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
       短信设置
      </h1>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="breadcrumb-item"><a href="#">System setting</a></li>
        <li class="breadcrumb-item active">SMS function</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
     
      <div class="row">		  
        <div class="col-lg-12 col-12">
			<!-- Basic Forms -->
			  <div class="box">
				<div class="box-header with-border">
				  <h4 class="box-title">短信设置</h4>			
					<ul class="box-controls pull-right">
					  <li><a class="box-btn-close" href="#"></a></li>
					  <li><a class="box-btn-slide" href="#"></a></li>	
					  <h4 class="box-title"><a href="<{:U('System/smsTemplateList')}>" class="btn btn-info btn-xs" >短信模版</a></h4>
					</ul>
				</div>
				<!-- /.box-header -->
  <form class="layui-form" action="" autocomplete="off" id="baseForm">
                    <input type="hidden" name="id" id="id" value="<{$vo.id}>">
				<div class="box-body">
				  <div class="row">
					<div class="col-10">
                      
						<div class="form-group  row">
                         <label for="example-dianxi-input" class="col-sm-2 col-form-label">短信通道：</label>
            <div class="col-sm-2">
				<select name="sms_channel" class="form-control select2" style="width: 100%;" lay-filter="">
                                <option value=""  selected="selected">请选择短信通道</option>
                                <option value="aliyun" <eq name="vo.sms_channel" value="aliyun">selected="selected"</eq>>阿里云</option>
                                <option value="smsbao" <eq name="vo.sms_channel" value="smsbao">selected="selected"</eq>>短信宝</option>
                            </select>
						</div> 
						</div>
                
						<div class="form-group row">
						  <label for="example-search-input" class="col-sm-2 col-form-label">阿里云App Key：<span class="text-danger">*</span></label>
	  <div class="col-sm-3">
					 <input type="text" name="app_key" value="<{$vo.app_key}>" placeholder="App Key" autocomplete="off" class="form-control">
		</div>
						</div>
                
						<div class="form-group row">
						  <label for="example-email-input" class="col-sm-2 col-form-label">阿里云App Secret：</label>
						  <div class="col-sm-3">
							<input type="text" name="app_secret" value="<{$vo.app_secret}>" placeholder="" placeholder="" autocomplete="off" class="form-control">
						  </div>
						</div>
                
						<div class="form-group row">
						  <label for="example-url-input" class="col-sm-2 col-form-label">短信宝账号：</label>
						  <div class="col-sm-3">
						 <input type="text" name="smsbao_user" value="<{$vo.smsbao_user}>" placeholder="短信宝账号"  autocomplete="off" class="form-control">
						  </div>
						</div>
                
						<div class="form-group row">
						  <label for="example-tel-input" class="col-sm-2 col-form-label">短信宝密钥：</label>
						  <div class="col-sm-3">
						<input type="text" name="smsbao_pass" value="<{$vo.smsbao_pass}>" placeholder="短信宝密钥"  placeholder="" autocomplete="off" class="form-control">
						  </div>
						</div>
                
						<div class="form-group row">
						  <label for="example-password-input" class="col-sm-2 col-form-label">短信签名：</label>
						  <div class="col-sm-2">
                             <input type="text" name="sign_name" value="<{$vo.sign_name}>"   placeholder="例如：聚合支付平台"  lay-verify="required" placeholder="" autocomplete="off" class="form-control">
						  </div>
						</div>
                
                          <div class="form-group row">
						  <label for="example-password-input" class="col-sm-2 col-form-label">短信功能开关：</label>
						  <div class="col-sm-2">
                          <input type="radio" name="is_open" value="1" title="开启" <if
                                condition="$vo['is_open'] eq 1">checked
                        </if>>
                            <input type="radio" name="is_open" value="0" title="关闭" <if
                                condition="$vo['is_open'] eq 0">checked
                        </if>>
						  </div>
						</div>
				
        <if condition="$verifyGoogle and $verifysms">
                <div class="form-group row"  id="df_auto_check">
              <label class="col-sm-2 col-form-label">验证方式：</label>
                    <div class="col-sm-8">
                        <input type="radio" name="auth_type" lay-filter="auth_type" id="radio_21" value="1" title="谷歌安全码" checked>
                        <input type="radio" name="auth_type" lay-filter="auth_type" id="radio_22" value="0" title="短信验证码">
                    </div>
                </div>
                <else />
                <input type="hidden" name="auth_type" value="<{$auth_type}>">
            </if>
            <eq name="verifyGoogle" value="1">
                    <div class="form-group row"  id="auth_google">
						  <label for="example-week-input" class="col-sm-2 col-form-label">谷歌安全码：</label>
                    <div class="col-sm-2">
                        <input type="text" name="google_code" autocomplete="off"
                               placeholder="请输入谷歌安全码" class="form-control"   value="">
                    </div>
                </div>

            </eq>

            <eq name="verifysms" value="1">          
              	<div class="input-group row" id="auth_sms" <if condition="$verifyGoogle and $verifysms">style="display: none"</if>>
             <label for="example-week-input" class="col-sm-2 col-form-label">短信验证码：</label>
            <div class="input-group-prepend col-sm-3">
                  <input type="text" name="code"  autocomplete="off" placeholder="输入验证码" class="form-control" value="">
                <button href="javascript:;" type="button"  id="sendBtn" data-mobile="<{$mobile}>"   class="btn btn-xs btn-danger" title="点击获取短信验证码"><i class="glyphicon glyphicon-stats"></i> 获取短信验证码</button>
                </div>
				</div>
 <p class="my-20"></p> 
</eq>
              
					
				  <!-- /.row -->
                  <div class="form-group row">
 <label for="example-password-input1" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-2">
						<button class="btn btn-success btn-sm" lay-submit="" lay-filter="add"><i class="fa fa-check-square-o"></i> 提交保存</button>
                  <button type="reset" class="btn btn-secondary btn-sm"><i class="glyphicon glyphicon-remove"></i>  重置</button>
					</div>	
                  </div>
				</div>
				<!-- /.box-body -->
</form>
                

                <div class="box-footer col-sm-10">
                <div class="input-group row">		
                <label for="example-password-input" class="col-sm-2 col-form-label">测试短信 接收手机：</label>
                <div class="input-group-prepend col-sm-3">
                     <input type="mobile" autocomplete="off" class="form-control" id="cs_text" name="cs_text" value=""  placeholder="例如：13800138000">
                      <button onclick="sendMobile()"  type="button"  lay-submit=""  class="btn  btn-primary btn-sm" title="点击获取短信验证码"><i class="glyphicon glyphicon-stats"></i> 测试接收验证码</button>
                    </div>
                   
                </div>
                       </div>	  </div>
			  <!-- /.box -->			
		</div>		  


        <!--/.col (right) -->

      <!-- /.row -->
            </div>
    </section>
    <!-- /.content -->
  </div>  
  <!-- /.content-wrapper -->

 <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
<!-- ./wrapper -->
<include file="Public/footer"/>
  <!-- /.content-wrapper -->

<script>
    layui.use(['form', 'laydate'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,laydate = layui.laydate;
        //自定义验证规则
        form.verify({

        });
        //监听提交
        form.on('submit(add)', function(data){
            $.ajax({
                url:"<{:U('System/saveSms')}>",
                type:"post",
                data:$('#baseForm').serialize(),
                success:function(res){
                    if(res.status){
                        layer.alert("短信设置操作成功", {icon: 6},function () {
                            location.reload();
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                    }else{
                        layer.msg(res.msg?res.msg:"操作失败!", {icon: 5},function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                        return false;
                    }
                }
            });
            return false;
        });
      form.on('radio(auth_type)',function(data){
        if(data.value == 1) {
            $('#auth_google').show();
            $('#auth_sms').hide();
        } else {
            $('#auth_google').hide();
            $('#auth_sms').show();
        }
    });
    });
    function sendMobile() {
        $.ajax({
            url:"<{:U('System/testMobile')}>",
            type:"post",
            data:'cs_text='+$('#cs_text').val(),
            success:function(res){
                if(res.status){
                    layer.alert(res.msg, {icon: 6},function () {
                        location.reload();
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    });
                }else{
                    layer.msg(res.msg, {icon: 5},function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    });
                    return false;
                }
            }
        });
    };
</script>
<script>
    $(function (){
        var sendUrl = "<{:U('System/sysconfigSend')}>";
        // 手机验证码发送
        $('#sendBtn').click(function(){
            var mobile = $(this).data('mobile');
            if(mobile == '') {
                layer.alert('请先绑定手机号码',{icon: 5}, function() {
                    location.href = "<{:U('System/bindMobileShow')}>";
                });
                return;
			}
            sendSms(this, mobile, sendUrl);
        });
    })
</script>
</body>
</html>